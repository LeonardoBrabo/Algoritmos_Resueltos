Accion Act_Unitaria_2.19 Es

	AMBIENTE

	FECHA = REGISTRO
		AA: N(4);
		MM: 1..12;
		DD: 1..31;
	FR;

	MAE= REGISTRO
		CLAVE: REGISTRO
			FARMACIA: N(2);
			MEDICAMENTO: N(5);
		FR;
		CANT_ACTUAL: N(6);
		FECHA-VENCE:FECHA;		
	FR;

	ARCH_MAE, ARCH_SAL: Archivo de MAE ordenado por CLAVE;
	REG_MAE, REG_SAL : MAE;

	MOV = REGISTRO
		CLAVE: REGISTRO
			FARMACIA: N(2);
			MEDICAMENTO: N(5);
		FR;
		CODMOD: 1..3;
		CANT-RECIBIDA: N(6);
	FR;

	ARCH_MOV: Archivo de MOV ordenado por CLAVE,CODMOD;
	REG_MOV: MOV;

	VENCIDOS = REGISTRO
		MEDICAMENTO: N(5);
		CANT-VENCIDA: N(6);
	FR;

	ARCH_VEN: Archivo de VENCIDOS ordenado por MEDICAMENTO;
	REG_VEN: VENCIDOS;

	SUBACCION LEER_MAE ES
		LEER(ARCH_MAE,REG_MAE);
		SI FDA(ARCH_MAE) ENTONCES
			REG_MAE.CLAVE:= HV;
		FS;
	FSUB;

	SUBACCION LEER_MOV ES
		LEER(ARCH_MOV, REG_MOV)
		SI FDA(ARCH_MOV) ENTONCES
			REG_MOV.CLAVE:= HV;
		FS;
	FSUB;

	PROCESO
	ABRIR E/(ARCH_MAE); ABRIR E/(ARCH_MOV);
	ABRIR /S(ARCH_SAL); ABRIR /S(ARCH_VEN);
	LEER_MAE; LEER_MOV;
	
	MIENTRAS (ARCH_MAE <> HV) v (ARCH_MOV <> HV) HACER			
		SI REG_MAE.CLAVE < REG_MOV.CLAVE ENTONCES					
			REG_SAL:= REG_MAE;
			ESCRIBIR(ARCH_SAL,REG_SAL);
			LEER_MAE;
		SINO
			SI REG_MAE.CLAVE = REG_MOV.CLAVE ENTONCES
				SEGUN REG_MOV.COD_MOD HACER
					1: ESCRIBIR("Error alta invalida");
						REG_SAL:= REG_MAE;
						ESCRIBIR(ARCH_SAL,REG_SAL);

					2: 	
						REG_VEN.MEDICAMENTO:= REG_MAE.CLAVE.MEDICAMENTO;
						REG_VEN.CANT_VENCIDA:= REG_MAE.CANT-ACTUAL;
						ESCRIBIR(ARCH_VEN,REG_VEN);

					3:
						REG_SAL:= REG_MAE;
						REG_SAL.CANT-ACTUAL:= REG_MOV.CANT-RECIBIDA:
						ESCRIBIR(ARCH_SAL,REG_SAL);
				FS;
				LEER_MAE; LEER_MOV;
			SINO

				SI REG_MAE.CLAVE > REG_MOV.CLAVE ENTONCES
					SEGUN REG_MOV.CODMOD HACER					
						1:
							REG_SAL.CLAVE.FARMACIA:= REG_MOV.CLAVE.FARMACIA;
							REG_SAL.CLAVE.MEDICAMENTO:= REG_MOV.CLAVE.MEDICAMENTO;
							REG_SAL.CANT-ACTUAL:= REG_MOV.CANT-RECIBIDA;
							REG_SAL.FECHA-VENCE:= FECHA_ACTUAL() + 30;					//Funcion por defecto de la pc
							ESCRIBIR(ARCH_SAL,REG_SAL);

						2: ESCRIBIR("Error baja invalida");

						3: ESCRIBIR("Error modificacion invalida");
					FS;
					LEER_MOV;
				FS;
			FS;
		FS;
	FM;
	CERRAR(ARCH_MAE); CERRAR(ARCH_MOV); CERRAR(ARCH_SAL); CERRAR(ARCH_VEN);

Fin Accion.



